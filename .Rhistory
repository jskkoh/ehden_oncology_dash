runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
library(tidyverse)
library(tidyverse)
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
input <- list(cancerType="BreastCancer", age="All",sex="Both",
list("Gompertz","Weibull", "Log-logistic",
"Generalised gamma","Spline (1 knot)",
"Spline (3 knots)"))
survEx_df = read_excel("./data/cancer_extrapolation_results_ALL.xlsx",sheet="extrapolation_all")
dataSurv <- survEx_df
tableSurvPlot <- dataSurv %>%
filter(Cancer=cancerType & Age=age & Gender=sex & Method %in% extrapMeth)
tableSurvPlot <- dataSurv %>%
filter(Cancer==cancerType & Age==age & Gender==sex & Method %in% extrapMeth)
View(dataSurv)
dataSurv <- survEx_df; cancerType=input$cancerType
age=input$age; sex=input$sex; extrapMeth=input$extrapMeth
age=input$age; sex=input$sex; extrapMeth=unlist(input$extrapMeth)
as.vector(input$extrapMeth)
input$extrapMeth
input <- list(cancerType="BreastCancer", age="All",sex="Both",
extrapMeth=list("Gompertz","Weibull", "Log-logistic",
"Generalised gamma","Spline (1 knot)",
"Spline (3 knots)"))
extrapMeth=input$extrapMeth
extrapMeth=unlist(input$extrapMeth)
tableSurvPlot <- dataSurv %>%
filter(Cancer==cancerType & Age==age & Gender==sex & Method %in% extrapMeth)
View(tableSurvPlot)
tab <- survPlotTable(dataSurv,input$cancerType,input$age,input$sex,input$extrapMeth)
survPlotTable <- function(dataSurv,cancerType,age,sex,extrapMeth) {
tableSurvPlot <- dataSurv %>%
filter(Cancer==cancerType & Age==age & Gender==sex & Method %in% extrapMeth)
return(tableSurvPlot)
}
tab <- survPlotTable(dataSurv,input$cancerType,input$age,input$sex,input$extrapMeth)
kmCprd_df = read_excel("./data/cancer_KM_observed_results_ALL.xlsx",sheet="KM_observed_all")
View(kmCprd_df)
runApp()
View(tableSurvPlot)
runApp()
runApp()
runApp()
View(kmCprd_df)
View(survEx_df)
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
View(tableSurvPlot)
runApp()
survExCprd_df = read_excel("./data/cancer_extrapolation_results_ALL.xlsx",sheet="extrapolation_all") %>%
mutate(time=round(time,3),est=round(est,3),lcl=round(lcl,3),ucl=round(ucl,3))
survExCprd_df = read_excel("./data/cancer_extrapolation_results_ALL.xlsx",sheet="extrapolation_all") %>%
mutate(time=round(time,3),est=round(est,3),lcl=round(lcl,3),ucl=round(ucl,3))
rateHazCprd_df = read_excel("./data/cancer_extrapolation_results_ALL.xlsx",sheet="hazardrate_all") %>%
mutate(time=round(time,3),est=round(est,4),lcl=round(lcl,4),ucl=round(ucl,4))
fitCprd_df = read_excel("./data/cancer_extrapolation_results_ALL.xlsx",sheet="GOF_all") %>%
mutate(trisk=round(trisk,0),logLik=round(logLik,3),AIC=round(AIC,3),BIC=round(BIC,3))
kmCprd_df = read_excel("./data/cancer_KM_observed_results_ALL.xlsx",sheet="KM_observed_all") %>%
mutate(time=round(time,3),est=round(est,3),lcl=round(lcl,3),ucl=round(ucl,3))
runApp()
survExCprd_df = read_csv("./data/survivalCurveExtrapolations.csv") %>%
mutate(time=round(time,3),est=round(est,3),lcl=round(lcl,3),ucl=round(ucl,3))
rateHazCprd_df = read_csv("./data/survivalHazardRates.csv") %>%
mutate(time=round(time,3),est=round(est,4),lcl=round(lcl,4),ucl=round(ucl,4))
fitCprd_df = read_csv("./data/survivalGOF.csv") %>%
mutate(trisk=round(trisk,0),logLik=round(logLik,3),AIC=round(AIC,3),BIC=round(BIC,3))
kmCprd_df = read_csv("./data/survivalKM.csv") %>%
mutate(time=round(time,3),est=round(est,3),lcl=round(lcl,3),ucl=round(ucl,3))
runApp()
runApp()
runApp()
View(fitCprd_df)
View(survExCprd_df)
runApp()
survExCprd_df = read_csv("./data/survivalCurveExtrapolations.csv") %>%
mutate(time=round(time,3),est=round(est,3),lcl=round(lcl,3),ucl=round(ucl,3))
rateHazCprd_df = read_csv("./data/survivalHazardRates.csv") %>%
mutate(time=round(time,3),est=round(est,4),lcl=round(lcl,4),ucl=round(ucl,4))
fitCprd_df = read_csv("./data/survivalGOF.csv") %>%
mutate(trisk=round(trisk,0),logLik=round(logLik,3),AIC=round(AIC,3),BIC=round(BIC,3))
kmCprd_df = read_csv("./data/survivalKM.csv") %>%
mutate(time=round(time,3),est=round(est,3),lcl=round(lcl,3),ucl=round(ucl,3))
survExCprd_df = read_csv("./data/survivalCurveExtrapolations.csv")
# load ref df with English life table (ONS) and HRQoL estimates (HSE and MVH) by age and sex
survExCprd_df = read_csv("./data/survivalCurveExtrapolations.csv",col_types = cols())
survExCprd_df = read_csv("./data/survivalCurveExtrapolations.csv",col_types = cols()) %>%
mutate(time=round(time,3),est=round(est,3),lcl=round(lcl,3),ucl=round(ucl,3))
rateHazCprd_df = read_csv("./data/survivalHazardRates.csv",col_types = cols()) %>%
mutate(time=round(time,3),est=round(est,4),lcl=round(lcl,4),ucl=round(ucl,4))
fitCprd_df = read_csv("./data/survivalGOF.csv",col_types = cols()) %>%
mutate(trisk=round(trisk,0),logLik=round(logLik,3),AIC=round(AIC,3),BIC=round(BIC,3))
kmCprd_df = read_csv("./data/survivalKM.csv",col_types = cols()) %>%
mutate(time=round(time,3),est=round(est,3),lcl=round(lcl,3),ucl=round(ucl,3))
runApp()
survExCprd_df = read_csv("./data/survivalCurveExtrapolations.csv",col_types = cols()) %>%
mutate(time=round(time,3),est=round(est,3),lcl=round(lcl,3),ucl=round(ucl,3)) %>%
group_by(Method,Cancer,Age,Gender)
survExCprd_df = read_csv("./data/survivalCurveExtrapolations.csv",col_types = cols()) %>%
mutate(time=round(time,3),est=round(est,3),lcl=round(lcl,3),ucl=round(ucl,3)) %>%
group_by(Method,Cancer,Age,Gender) %>%  sample_frac(.2, replace = FALSE)
runApp()
View(survExCprd_df)
runApp()
runApp()
survExCprd_df = read_csv("./data/survivalCurveExtrapolations.csv",col_types = cols()) %>%
mutate(time=round(time,3),est=round(est,3),lcl=round(lcl,3),ucl=round(ucl,3)) %>%
ungroup() %>% arrange(time)
group_by(Method,Cancer,Age,Gender) %>%  sample_frac(.2, replace = FALSE) %>% ungroup()
runApp()
survExCprd_df = read_csv("./data/survivalCurveExtrapolations.csv",col_types = cols()) %>%
mutate(time=round(time,3),est=round(est,3),lcl=round(lcl,3),ucl=round(ucl,3))
group_by(Method,Cancer,Age,Gender) %>%  sample_frac(.2, replace = FALSE) %>%
ungroup() %>% arrange(time)
View(survExCprd_df)
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
View(rateHazCprd_df)
runApp()
runApp()
runApp()
survFrac <- 0.05
# Load survival curve, hazard rate and GoF data
survExCprd_df = read_csv("./data/survivalCurveExtrapolations.csv",col_types = cols()) %>%
mutate(time=round(time,3),est=round(est,3),lcl=round(lcl,3),ucl=round(ucl,3)) %>%
group_by(Method,Cancer,Age,Gender) %>%  sample_frac(survFrac, replace = FALSE) %>%
ungroup() %>% arrange(time)
rateHazCprd_df = read_csv("./data/survivalHazardRates.csv",col_types = cols()) %>%
mutate(time=round(time,3),est=round(est,4),lcl=round(lcl,4),ucl=round(ucl,4)) %>%
group_by(Method,Cancer,Age,Gender) %>%  sample_frac(survFrac, replace = FALSE) %>%
ungroup() %>% arrange(time)
fitCprd_df = read_csv("./data/survivalGOF.csv",col_types = cols()) %>%
mutate(trisk=round(trisk,0),logLik=round(logLik,3),AIC=round(AIC,3),BIC=round(BIC,3))
kmCprd_df = read_csv("./data/survivalKM.csv",col_types = cols()) %>%
mutate(time=round(time,3),est=round(est,3),lcl=round(lcl,3),ucl=round(ucl,3)) %>%
group_by(Method,Cancer,Age,Gender) %>%  sample_frac(survFrac, replace = FALSE) %>%
ungroup() %>% arrange(time)
View(rateHazCprd_df)
runApp()
View(rateHazCprd_df)
View(rateHazCprd_df)
test = hazPlotTable(rateHazCprd_df,"BreastCancer","All","Both")
View(test)
hazPlotTable <- function(dataHaz,cancerType,age,sex) {
tableHazPlot <- dataHaz %>%
filter(Cancer==cancerType & Age==age & Gender==sex) %>%
select(time,est,lcl,ucl,Method) %>% arrange(time,method)
return(tableHazPlot)
}
test = hazPlotTable(rateHazCprd_df,"BreastCancer","All","Both")
hazPlotTable <- function(dataHaz,cancerType,age,sex) {
tableHazPlot <- dataHaz %>%
filter(Cancer==cancerType & Age==age & Gender==sex) %>%
select(time,est,lcl,ucl,Method) %>% arrange(time,Method)
return(tableHazPlot)
}
test = hazPlotTable(rateHazCprd_df,"BreastCancer","All","Both")
hazPlotTable <- function(dataHaz,cancerType,age,sex) {
tableHazPlot <- dataHaz %>%
filter(Cancer==cancerType & Age==age & Gender==sex) %>%
select(time,est,lcl,ucl,Method) %>% arrange(Method,time)
return(tableHazPlot)
}
test = hazPlotTable(rateHazCprd_df,"BreastCancer","All","Both")
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
View(fitCprd_df)
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
View(fitCprd_df)
dataGOF = fitCprd_df
cancerType = "BreastCancer"
age = "All"
sex = "Both"
View(dataGOF)
tableGOF <- dataGOF %>%
filter(Cancer==cancerType & Age==age & Gender==sex) %>%
select(-Cancer,-Age,-Gender)
colnames(gofTable) <- c("N","Events","Censored","Time at risk","df",
"logLik","AIC","BIC","Method")
gofTable <- gofTable[,c(9,1,2,3,4,5,6,7,8)]
tableGOF <- dataGOF %>%
filter(Cancer==cancerType & Age==age & Gender==sex) %>%
select(-Cancer,-Age,-Gender)
colnames(tableGOF) <- c("N","Events","Censored","Time at risk","df",
"logLik","AIC","BIC","Method")
gofTable <- tableGOF[,c(9,1,2,3,4,5,6,7,8)]
View(tableGOF)
tableGOF <- tableGOF[,c(9,1,2,3,4,5,6,7,8)]
View(tableGOF)
library(DT)
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
.rLibPaths()
.libPaths()
.libsPath()
.libPath()
.libPaths()
data(lung)
library(survival)
lung <- data(lung)
data(lung)
survExCprd_df = readRDS("./data/survExCprd.csv")
survExCprd_df = readRDS("./data/survival_estimates_CPRD_Aurum.rds")
View(survExCprd_df)
riskTableCprd_df = read_csv("./data/riskTableCprd.csv",col_types = cols())
library(tidyverse)
library(DT)
library(readxl)
riskTableCprd_df = read_csv("./data/riskTableCprd.csv",col_types = cols())
riskTableCprd_df1 <- readRDS("./data/risk_table_results_CPRD_Aurum.rds")
View(riskTableCprd_df)
View(riskTableCprd_df1)
rownames(riskTableCprd_df1) <- NULL
riskTableCprd_df1 <- readRDS("./data/risk_table_results_CPRD_Aurum.rds") %>%
select(-Method,-Stratification,-GenderAge)
survAvgCprd_df = read_csv("./data/survAvgCprd.csv",col_types = cols())
View(survAvgCprd_df)
survAvgCprd_df1 = readRDS("./data/median_survival_results_CPRD_Aurum.rds")
survAvgCprd_df = read_csv("./data/survAvgCprd.csv",col_types = cols())
View(survAvgCprd_df1)
View(survAvgCprd_df)
survAvgCprd_df1 = readRDS("./data/median_survival_results_CPRD_Aurum.rds") %>%
mutate(meanSurv=round(`*rmean`,3),medianSurv=round(median,3)) %>%
select(Cancer,Age,Gender,meanSurv,medianSurv,Database)
rateHazObsCprd_df1 = readRDS("./data/hazard_overtime_results_CPRD_Aurum.rds")
rateHazObsCprd_df = read_csv("./data/rateHazObsCprd.csv",col_types = cols())
View(rateHazObsCprd_df)
View(rateHazObsCprd_df1)
rateHazObsCprd_df1 = readRDS("./data/hazard_overtime_results_CPRD_Aurum.rds") %>%
mutate(method="Observed") %>%
select(-Stratification,-GenderAge)
rateHazObsCprd_df1 = readRDS("./data/hazard_overtime_results_CPRD_Aurum.rds") %>%
mutate(Method="Observed") %>%
select(-Stratification,-GenderAge)
rateHazObsCprd_df = read_csv("./data/rateHazObsCprd.csv",col_types = cols())
View(rateHazObsCprd_df1)
View(rateHazObsCprd_df1)
View(rateHazObsCprd_df)
View(rateHazObsCprd_df)
27622/8
3452/25
monthIntervals <- data.frame(time2=seq(0,25,1/6)) %>%
mutate(matchid=row_number())
View(monthIntervals)
monthIntervals <- data.frame(time2=seq(0,25,1/52)) %>%
mutate(matchid=row_number())
rateHazObsCprd_df = readRDS("./data/hazard_overtime_results_CPRD_Aurum.rds") %>%
mutate(Method="Observed") %>%
select(-Stratification,-GenderAge) %>%
rowwise() %>%
mutate(matchid=which.min(abs(monthIntervals$time2-time))) %>%
left_join(monthIntervals,by="matchid") %>%
mutate(absDiff=abs(time2-time)) %>% group_by(Method,Cancer,Age,Gender,time2) %>%
filter(absDiff==min(absDiff)) %>%
mutate(time=round(time2,3),est=round(est,5),lcl=round(lcl,5),ucl=round(ucl,5))
670363/235735
138/52
View(rateHazObsCprd_df)
View(rateHazObsCprd_df)
rateHazObsCprd_df = readRDS("./data/hazard_overtime_results_CPRD_Aurum.rds") %>%
mutate(Method="Observed") %>%
rowwise() %>%
mutate(matchid=which.min(abs(monthIntervals$time2-time))) %>%
left_join(monthIntervals,by="matchid") %>%
mutate(absDiff=abs(time2-time)) %>% group_by(Method,Cancer,Age,Gender,time2) %>%
filter(absDiff==min(absDiff)) %>%
mutate(time=round(time2,3),est=round(est,5),lcl=round(lcl,5),ucl=round(ucl,5)) %>%
ungroup() %>%
select(-Stratification,-GenderAge,-matchid,-time2,-absDiff)
View(rateHazObsCprd_df)
kmCprd_df = readRDS("./data/survival_estimates_CPRD_Aurum.rds") %>%
mutate(Method="Observed")
kmCprd_df1 = read_csv("./data/kmCprd.csv",col_types = cols())
View(kmCprd_df)
kmCprd_df = readRDS("./data/survival_estimates_CPRD_Aurum.rds") %>%
mutate(Method="Observed") %>%
# Taking the subset of observations specified in monthIntervals
rowwise() %>%
mutate(matchid=which.min(abs(monthIntervals$time2-time))) %>%
left_join(monthIntervals,by="matchid") %>%
mutate(absDiff=abs(time2-time)) %>% group_by(Method,Cancer,Age,Gender,time2) %>%
filter(absDiff==min(absDiff)) %>%
mutate(time=round(time2,3),est=round(est,5),lcl=round(lcl,5),ucl=round(ucl,5)) %>%
ungroup() %>%
select(-Stratification,-GenderAge,-matchid,-time2,-absDiff)
View(kmCprd_df)
fitCprd_df = readRDS("./data/Goodness_of_fit_results_CPRD_Aurum.rds")
View(fitCprd_df)
fitCprd_df = readRDS("./data/Goodness_of_fit_results_CPRD_Aurum.rds") %>%
mutate(trisk=round(trisk,0),logLik=round(logLik,3),
AIC=round(AIC,3),BIC=round(BIC,3))
fitCprd_df1 = read_csv("./data/fitCprd.csv",col_types = cols())
View(fitCprd_df)
View(fitCprd_df1)
fitCprd_df = readRDS("./data/Goodness_of_fit_results_CPRD_Aurum.rds") %>%
mutate(trisk=round(trisk,0),logLik=round(logLik,3),
AIC=round(AIC,3),BIC=round(BIC,3))
select(-Method,-Stratification,-GenderAge)
fitCprd_df = readRDS("./data/Goodness_of_fit_results_CPRD_Aurum.rds") %>%
mutate(trisk=round(trisk,0),logLik=round(logLik,3),
AIC=round(AIC,3),BIC=round(BIC,3))
select(-Stratification,-GenderAge)
View(fitCprd_df)
fitCprd_df = readRDS("./data/Goodness_of_fit_results_CPRD_Aurum.rds") %>%
mutate(trisk=round(trisk,0),logLik=round(logLik,3),
AIC=round(AIC,3),BIC=round(BIC,3)) %>%
select(-Stratification,-GenderAge)
extrap_param = readRDS("./data/extrapolation_parameters_CPRD_Aurum.rds")
View(extrap_param)
colnames(extrap_param)
kmCprd_df = readRDS("./data/survival_estimates_CPRD_Aurum.rds") %>%
mutate(Method="Observed") %>%
# Taking the subset of observations specified in monthIntervals
rowwise() %>%
mutate(matchid=which.min(abs(monthIntervals$time2-time))) %>%
left_join(monthIntervals,by="matchid") %>%
mutate(absDiff=abs(time2-time)) %>% group_by(Method,Cancer,Age,Gender,time2) %>%
filter(absDiff==min(absDiff)) %>%
mutate(time=round(time2,3),est=round(est,5),lcl=round(lcl,5),ucl=round(ucl,5)) %>%
ungroup() %>%
select(-Stratification,-GenderAge,-matchid,-time2,-absDiff)
View(kmCprd_df)
kmCprd_df = readRDS("./data/survival_estimates_CPRD_Aurum.rds")
View(kmCprd_df)
kmCprd_df = readRDS("./data/survival_estimates_CPRD_Aurum.rds") %>%
mutate(Method=ifelse(Method=="Kaplan-Meier","Observed",Method))
View(kmCprd_df)
monthIntervals <- data.frame(time2=seq(0,25,1/52)) %>%
mutate(matchid=row_number())
# For extrapolation and hazard data, timepoints are matched to nearest
# specified interval
# Goodness of fit statistics
fitCprd_df = readRDS("./data/Goodness_of_fit_results_CPRD_Aurum.rds") %>%
mutate(trisk=round(trisk,0),logLik=round(logLik,3),
AIC=round(AIC,3),BIC=round(BIC,3)) %>%
select(-Stratification,-GenderAge)
write_rds(fitCprd_df,"./data/fitCprd.rds",row.names=F)
write_rds(fitCprd_df,"./data/fitCprd.rds")
fitCprd_df = readRDS("./data/fitCprd.rds")
View(fitCprd_df)
saveRDS(fitCprd_df,"./data/fitCprd.rds")
# Script to load, format and save survival extrapolation data
# to be loaded into the dashboard
# Specify a set of intervals to take subset of K-M observations
monthIntervals <- data.frame(time2=seq(0,25,1/52)) %>%
mutate(matchid=row_number())
# For extrapolation and hazard data, timepoints are matched to nearest
# specified interval
# Goodness of fit statistics
fitCprd_df = readRDS("./data/Goodness_of_fit_results_CPRD_Aurum.rds") %>%
mutate(trisk=round(trisk,0),logLik=round(logLik,3),
AIC=round(AIC,3),BIC=round(BIC,3)) %>%
select(-Stratification,-GenderAge)
# Survival curves
SurvCprd_df = readRDS("./data/survival_estimates_CPRD_Aurum.rds") %>%
mutate(Method=ifelse(Method=="Kaplan-Meier","Observed",Method)) %>%
# Taking the subset of observations specified in monthIntervals
rowwise() %>%
mutate(matchid=which.min(abs(monthIntervals$time2-time))) %>%
left_join(monthIntervals,by="matchid") %>%
mutate(absDiff=abs(time2-time)) %>% group_by(Method,Cancer,Age,Gender,time2) %>%
filter(absDiff==min(absDiff)) %>%
mutate(time=round(time2,3),est=round(est,5),lcl=round(lcl,5),ucl=round(ucl,5)) %>%
ungroup() %>%
select(-Stratification,-GenderAge,-matchid,-time2,-absDiff)
# Hazard rate over time
rateHazObsCprd_df = readRDS("./data/hazard_overtime_results_CPRD_Aurum.rds") %>%
mutate(Method=ifelse(Method=="Kaplan-Meier","Observed",Method)) %>%
# Taking the subset of observations specified in monthIntervals
rowwise() %>%
mutate(matchid=which.min(abs(monthIntervals$time2-time))) %>%
left_join(monthIntervals,by="matchid") %>%
mutate(absDiff=abs(time2-time)) %>% group_by(Method,Cancer,Age,Gender,time2) %>%
filter(absDiff==min(absDiff)) %>%
mutate(time=round(time2,3),est=round(est,5),lcl=round(lcl,5),ucl=round(ucl,5)) %>%
ungroup() %>%
select(-Stratification,-GenderAge,-matchid,-time2,-absDiff)
# Mean/median survival estimates
survAvgCprd_df = readRDS("./data/median_survival_results_CPRD_Aurum.rds") %>%
mutate(meanSurv=round(`*rmean`,3),medianSurv=round(median,3)) %>%
select(Cancer,Age,Gender,meanSurv,medianSurv,Database)
# Number at risk summary table
riskTableCprd_df = readRDS("./data/risk_table_results_CPRD_Aurum.rds") %>%
select(-Method,-Stratification,-GenderAge)
rownames(riskTableCprd_df) <- NULL
# Write all formatted csv data files
saveRDS(SurvCprd_df,"./data/survCprd.rds")
saveRDS(rateHazCprd_df,"./data/rateHazCprd.rds")
saveRDS(fitCprd_df,"./data/fitCprd.rds")
saveRDS(survAvgCprd_df,"./data/survAvgCprd.rds")
saveRDS(riskTableCprd_df,"./data/riskTableCprd.rds")
rateHazCprd_df = readRDS("./data/hazard_overtime_results_CPRD_Aurum.rds") %>%
mutate(Method=ifelse(Method=="Kaplan-Meier","Observed",Method)) %>%
# Taking the subset of observations specified in monthIntervals
rowwise() %>%
mutate(matchid=which.min(abs(monthIntervals$time2-time))) %>%
left_join(monthIntervals,by="matchid") %>%
mutate(absDiff=abs(time2-time)) %>% group_by(Method,Cancer,Age,Gender,time2) %>%
filter(absDiff==min(absDiff)) %>%
mutate(time=round(time2,3),est=round(est,5),lcl=round(lcl,5),ucl=round(ucl,5)) %>%
ungroup() %>%
select(-Stratification,-GenderAge,-matchid,-time2,-absDiff)
saveRDS(rateHazCprd_df,"./data/rateHazCprd.rds")
shiny::runApp()
View(fitCprd_df)
